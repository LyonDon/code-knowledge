事务

>事务就是一组原子性的查询语句，或者说一个独立的工作单元，事务内的语句，要么全部执行，要么都不执行

事务的ACID特性：

*	atomicity原子性
>一个事务必须被视为一个不可分割的最小工作单元

*	consistency一致性
>前后的数据完整性要保持一致

*	isolation隔离性
>多个用户并发访问时，一个事务不能被其他用户的事务干扰

*	durability持久性
>一个事务一旦被提交，其对数据库的改变时永久的

InnoDB应对死锁的办法是，将持有最少行级排他锁的事务进行回滚

对于非事务型的表，不存在自动提交的概念，相当于一直是自动提交

MVCC：多版本并发控制

### InnoDB和MyISAM

是MySQL的默认事务型引擎，也是最重要，最广泛的存储引擎。用来处理大量的短期事务

MyISAM是5.1版本之前默认的存储引擎，不支持事务和行级锁

|InnoDB|MyISAM
--|--|--
事务|支持|不支持
外键|支持|不支持（且包含外键的InnoDB表不能转为MyISAM）
索引方式|聚集索引|非聚集索引
表的行数|不保存|保存
全文索引|不支持|支持（查询效率更高）

### 转换表的引擎

*	alter table
*	导入与导出
*	创建于查询（create 和 select）

## MySQL四种事务隔离级别

隔离级别|脏读|不可重复读|幻读
--|--|--|--
未提交读（Read Uncommitted）|可能|可能|可能
已提交读（Read Committed）|不可能|可能|可能
可重复读（Repeatable read）|不可能|不可能|可能
可串行化（Serializable）|不可能|不可能|不可能

*	未提交读：允许脏读，可能读取到其他事务中未提交事务修改的属性

*	已提交读：只能读取已经提交的数据。Oracle等

*	可重复读：在同一个事务内的查询都是事务开始时刻一致的。InnoDB默认

*	串行读：完全串行化的读，每次读都需要获取表级共享锁，读写互相会阻塞

## MySQL基准测试

针对系统状态的一种压力测试，用于掌握系统的行为

*区别于真实压力测试，基准测试的强度更低，不想真实情况下的数据量那么大，变化多端*

*	系统测试
*	组件测试

测试指标：

*	吞吐量
*	响应时间或者延迟
*	并发性
*	可扩展性

*基准测试应运行足够长的时间*

*每一次测试中，修改的参数应该尽可能的少*

测试类型：

*	集成式测试
	*	集成式测试工具

		*	ab
		*	http_load
		*	JMeter

*	单组件式测试
	*	单组件式测试工具

		*	sysbench（一款多线程系统压测工具）等

#### BenchMark函数

用来测试某条指令的执行速度